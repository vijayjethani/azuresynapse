{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "vijaysynapseworkspace"
		},
		"vijaysynapseworkspace-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'vijaysynapseworkspace-WorkspaceDefaultSqlServer'"
		},
		"vijaysynapseworkspace-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://vijaysynapseadl.dfs.core.windows.net"
		},
		"nyc_tlc_yellow_sasUri": {
			"type": "secureString",
			"metadata": "Secure string for 'sasUri' of 'nyc_tlc_yellow'"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/vijaysynapseworkspace-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('vijaysynapseworkspace-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/vijaysynapseworkspace-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('vijaysynapseworkspace-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/vijaysqlpool')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"restorePointInTime": "0001-01-01T00:00:00",
				"annotations": []
			},
			"dependsOn": [],
			"location": "eastus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "CREATE TABLE [dbo].[Trip]\n(\n    [DateID] int NOT NULL,\n    [MedallionID] int NOT NULL,\n    [HackneyLicenseID] int NOT NULL,\n    [PickupTimeID] int NOT NULL,\n    [DropoffTimeID] int NOT NULL,\n    [PickupGeographyID] int NULL,\n    [DropoffGeographyID] int NULL,\n    [PickupLatitude] float NULL,\n    [PickupLongitude] float NULL,\n    [PickupLatLong] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [DropoffLatitude] float NULL,\n    [DropoffLongitude] float NULL,\n    [DropoffLatLong] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [PassengerCount] int NULL,\n    [TripDurationSeconds] int NULL,\n    [TripDistanceMiles] float NULL,\n    [PaymentType] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [FareAmount] money NULL,\n    [SurchargeAmount] money NULL,\n    [TaxAmount] money NULL,\n    [TipAmount] money NULL,\n    [TollsAmount] money NULL,\n    [TotalAmount] money NULL\n)\nWITH\n(\n    DISTRIBUTION = ROUND_ROBIN,\n    CLUSTERED COLUMNSTORE INDEX\n);\n\nCOPY INTO [dbo].[Trip]\nFROM 'https://nytaxiblob.blob.core.windows.net/2013/Trip2013/QID6392_20171107_05910_0.txt.gz'\nWITH\n(\n    FILE_TYPE = 'CSV',\n    FIELDTERMINATOR = '|',\n    FIELDQUOTE = '',\n    ROWTERMINATOR='0X0A',\n    COMPRESSION = 'GZIP'\n)\nOPTION (LABEL = 'COPY : Load [dbo].[Trip] - Taxi dataset');",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "vijaysqlpool",
						"databaseName": "vijaysqlpool"
					}
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 2')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT PassengerCount,\n      SUM(TripDistanceMiles) as SumTripDistance,\n      AVG(TripDistanceMiles) as AvgTripDistance\nFROM  dbo.Trip\nWHERE TripDistanceMiles > 0 AND PassengerCount > 0\nGROUP BY PassengerCount\nORDER BY PassengerCount;",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "vijaysqlpool",
						"databaseName": "vijaysqlpool"
					}
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/nyc_tlc_yellow')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"sasUri": "[parameters('nyc_tlc_yellow_sasUri')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Notebook 1')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "vijayapachepool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2"
					}
				},
				"metadata": {
					"saveOutput": true,
					"synapse_widget": {
						"version": "0.1",
						"state": {
							"6c83eb62-ed00-43b1-95d6-0c75154ae860": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"startLon": "-73.95500946044922",
												"puLocationId": "null",
												"startLat": "40.73378372192383",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:32:43",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:02:05",
												"doLocationId": "null",
												"paymentType": "2",
												"tripDistance": "8.66",
												"vendorID": "2",
												"endLon": "-73.9688491821289",
												"totalAmount": "30.3",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.67795181274414",
												"fareAmount": "29.0",
												"tipAmount": "0.0",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.9888916015625",
												"puLocationId": "null",
												"startLat": "40.758304595947266",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:41:32",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:08:59",
												"doLocationId": "null",
												"paymentType": "2",
												"tripDistance": "4.8",
												"vendorID": "1",
												"endLon": "-73.91947174072266",
												"totalAmount": "21.3",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.75845718383789",
												"fareAmount": "20.0",
												"tipAmount": "0.0",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.98031616210938",
												"puLocationId": "null",
												"startLat": "40.77208709716797",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:43:39",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:06:14",
												"doLocationId": "null",
												"paymentType": "2",
												"tripDistance": "3.96",
												"vendorID": "2",
												"endLon": "-73.9767074584961",
												"totalAmount": "18.3",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.73244857788086",
												"fareAmount": "17.0",
												"tipAmount": "0.0",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.99098205566406",
												"puLocationId": "null",
												"startLat": "40.73460388183594",
												"rateCodeId": "1",
												"passengerCount": "2",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:22:27",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:07:12",
												"doLocationId": "null",
												"paymentType": "2",
												"tripDistance": "9.4",
												"vendorID": "1",
												"endLon": "-73.91658782958984",
												"totalAmount": "36.3",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.64944839477539",
												"fareAmount": "35.0",
												"tipAmount": "0.0",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.9870834350586",
												"puLocationId": "null",
												"startLat": "40.72951889038086",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:59:10",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:03:36",
												"doLocationId": "null",
												"paymentType": "1",
												"tripDistance": "0.7",
												"vendorID": "1",
												"endLon": "-73.98332214355469",
												"totalAmount": "7.56",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.72229766845703",
												"fareAmount": "5.0",
												"tipAmount": "1.26",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.96588897705078",
												"puLocationId": "null",
												"startLat": "40.71061706542969",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:52:38",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:35:54",
												"doLocationId": "null",
												"paymentType": "1",
												"tripDistance": "5.4",
												"vendorID": "2",
												"endLon": "-73.98374938964844",
												"totalAmount": "35.16",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.73839569091797",
												"fareAmount": "28.0",
												"tipAmount": "5.86",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.98614501953125",
												"puLocationId": "null",
												"startLat": "40.730979919433594",
												"rateCodeId": "1",
												"passengerCount": "2",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:59:08",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:17:53",
												"doLocationId": "null",
												"paymentType": "1",
												"tripDistance": "4.0",
												"vendorID": "1",
												"endLon": "-74.00798797607422",
												"totalAmount": "21.35",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.704856872558594",
												"fareAmount": "16.5",
												"tipAmount": "3.55",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.95538330078125",
												"puLocationId": "null",
												"startLat": "40.78017044067383",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 10:47:27",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 10:45:00",
												"doLocationId": "null",
												"paymentType": "1",
												"tripDistance": "0.98",
												"vendorID": "2",
												"endLon": "-73.96331787109375",
												"totalAmount": "8.4",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.0",
												"endLat": "40.77479553222656",
												"fareAmount": "6.5",
												"tipAmount": "1.1",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.98506927490234",
												"puLocationId": "null",
												"startLat": "40.74848175048828",
												"rateCodeId": "1",
												"passengerCount": "2",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 23:58:47",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:08:02",
												"doLocationId": "null",
												"paymentType": "2",
												"tripDistance": "1.6",
												"vendorID": "1",
												"endLon": "-73.98119354248047",
												"totalAmount": "9.3",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.764556884765625",
												"fareAmount": "8.0",
												"tipAmount": "0.0",
												"tollsAmount": "0.0"
											},
											{
												"startLon": "-73.98872375488281",
												"puLocationId": "null",
												"startLat": "40.731266021728516",
												"rateCodeId": "1",
												"passengerCount": "1",
												"puMonth": "3",
												"tpepPickupDateTime": "2015-02-28 03:07:05",
												"mtaTax": "0.5",
												"improvementSurcharge": "0.3",
												"tpepDropoffDateTime": "2015-03-01 00:00:00",
												"doLocationId": "null",
												"paymentType": "1",
												"tripDistance": "0.9",
												"vendorID": "2",
												"endLon": "-74.00213623046875",
												"totalAmount": "9.36",
												"storeAndFwdFlag": "N",
												"puYear": "2015",
												"extra": "0.5",
												"endLat": "40.732994079589844",
												"fareAmount": "6.5",
												"tipAmount": "1.56",
												"tollsAmount": "0.0"
											}
										],
										"schema": {
											"vendorID": "string",
											"tpepPickupDateTime": "int",
											"tpepDropoffDateTime": "int",
											"passengerCount": "int",
											"tripDistance": "double",
											"puLocationId": "string",
											"doLocationId": "string",
											"startLon": "double",
											"startLat": "double",
											"endLon": "double",
											"endLat": "double",
											"rateCodeId": "int",
											"storeAndFwdFlag": "string",
											"paymentType": "string",
											"fareAmount": "double",
											"extra": "double",
											"mtaTax": "double",
											"improvementSurcharge": "string",
											"tipAmount": "double",
											"tollsAmount": "double",
											"totalAmount": "double",
											"puYear": "int",
											"puMonth": "int"
										}
									},
									"isSummary": false,
									"language": "scala"
								},
								"persist_state": {
									"view": {
										"type": "details",
										"tableOptions": {},
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"vendorID"
											],
											"seriesFieldKeys": [
												"tpepPickupDateTime"
											],
											"isStacked": false
										}
									}
								}
							}
						}
					},
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/c5e95693-4d23-4d5c-ad8d-904f30699ecc/resourceGroups/vijaysynapse/providers/Microsoft.Synapse/workspaces/vijaysynapseworkspace/bigDataPools/vijayapachepool",
						"name": "vijayapachepool",
						"type": "Spark",
						"endpoint": "https://vijaysynapseworkspace.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/vijayapachepool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "2.4",
						"nodeCount": 10,
						"cores": 4,
						"memory": 28,
						"automaticScaleJobs": false
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"from azureml.opendatasets import NycTlcYellow\n",
							"\n",
							"data = NycTlcYellow()\n",
							"df = data.to_spark_dataframe()\n",
							"# Display 10 rows\n",
							"display(df.limit(10))"
						],
						"outputs": [],
						"execution_count": 1
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": true
						},
						"source": [
							"df.printSchema()"
						],
						"outputs": [],
						"execution_count": 2
					}
				]
			},
			"dependsOn": []
		}
	]
}